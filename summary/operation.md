# 运算
## 运算符
- C语言中提供了众多运算符，方便用户对基本数据类型进行相应计算工作

### C语言运算符速查表

- 下表按类别汇总常用 C 运算符，提供名称、示例与简短说明。最后附简版优先级与结合性参考。

**算术运算符**

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| + | 加法 | a + b | 整数/浮点相加 |
| - | 减法 | a - b | 整数/浮点相减 |
| * | 乘法 | a * b | 整数/浮点相乘 |
| / | 除法 | a / b | 整数除法截断小数；浮点保留小数 |
| % | 取余 | a % b | 仅整数；b 不可为 0 |

**关系运算符**

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| < | 小于 | a < b | 结果为 `int`（0/1） |
| <= | 小于等于 | a <= b | —— |
| > | 大于 | a > b | —— |
| >= | 大于等于 | a >= b | —— |
| == | 等于 | a == b | 比较值相等 |
| != | 不等 | a != b | 比较值不等 |

**逻辑运算符**

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| && | 逻辑与 | a && b | 短路求值；左为 0 则不求右 |
| \|\| | 逻辑或 | a \|\| b | 短路求值；左非 0 则不求右 |
| ! | 逻辑非 | !a | 非 0→0，0→1 |

**位运算符**（整型）

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| & | 位与 | a & b | 按位同时为 1 才为 1 |
| \| | 位或 | a \| b | 任一为 1 则为 1 |
| ^ | 位异或 | a ^ b | 不同为 1，相同为 0 |
| ~ | 位非 | ~a | 按位取反 |
| << | 左移 | a << n | 低位补 0；可能溢出 |
| >> | 右移 | a >> n | 有符号实现相关（算术/逻辑右移） |

**赋值与复合赋值**

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| = | 赋值 | a = b | 将右值赋给左值 |
| += | 加后赋值 | a += b | 等价 `a = a + b` |
| -= | 减后赋值 | a -= b | 等价 `a = a - b` |
| *= | 乘后赋值 | a *= b | 等价 `a = a * b` |
| /= | 除后赋值 | a /= b | 等价 `a = a / b` |
| %= | 余后赋值 | a %= b | 等价 `a = a % b` |
| &= | 位与赋值 | a &= b | 等价 `a = a & b` |
| \|= | 位或赋值 | a \|= b | 等价 `a = a \| b` |
| ^= | 位异或赋值 | a ^= b | 等价 `a = a ^ b` |
| <<= | 左移赋值 | a <<= n | 等价 `a = a << n` |
| >>= | 右移赋值 | a >>= n | 等价 `a = a >> n` |

**一元与自增/自减**

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| + | 一元正号 | +a | 不改变值（语义性） |
| - | 一元负号 | -a | 取相反数 |
| ++ | 自增 | ++a, a++ | 前缀/后缀语义不同 |
| -- | 自减 | --a, a-- | 前缀/后缀语义不同 |
| sizeof | 求大小 | sizeof(int) | 结果类型为 `size_t` |
| (type) | 强制类型转换 | (double)a | 按指定类型重解释/转换 |

**指针与成员访问**

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| & | 取地址 | &a | 得到对象的地址 |
| * | 解引用 | *p | 访问指针指向的对象 |
| [] | 下标 | a[i] | 等价 `*(a + i)` |
| . | 成员访问 | s.name | 结构体对象成员 |
| -> | 指针成员访问 | ps->name | 指向结构体的指针成员 |
| () | 函数调用 | f(x) | 调用函数（也用于分组） |

**条件与逗号**

| 运算符 | 名称 | 示例 | 说明 |
|---|---|---|---|
| ?: | 条件运算 | cond ? a : b | 根据条件选择分支 |
| , | 逗号运算 | expr1, expr2 | 先求左，结果为右值；常用于 `for` |

---

**优先级与结合性（简版）**

| 等级（高→低） | 结合性 | 代表运算符 |
|---|---|---|
| 后缀 | 左→右 | `()`, `[]`, `.`, `->`, `x++`, `x--` |
| 一元 | 右→左 | `++x`, `--x`, `+`, `-`, `!`, `~`, `(type)`, `sizeof`, `&`, `*` |
| 乘性 | 左→右 | `*`, `/`, `%` |
| 加性 | 左→右 | `+`, `-` |
| 移位 | 左→右 | `<<`, `>>` |
| 关系 | 左→右 | `<`, `<=`, `>`, `>=` |
| 相等 | 左→右 | `==`, `!=` |
| 位与 | 左→右 | `&` |
| 位异或 | 左→右 | `^` |
| 位或 | 左→右 | `\|` |
| 逻辑与 | 左→右 | `&&` |
| 逻辑或 | 左→右 | `\|\|` |
| 条件 | 右→左 | `?:` |
| 赋值 | 右→左 | `=`, `+=`, `-=`, `*=`, `/=`, `%=`, `&=`, `^=`, `\|=`, `<<=`, `>>=` |
| 逗号 | 左→右 | `,` |

> 提示：`&&` 与 `||` 采用短路求值；整数除法会截断小数；移位与右移的符号填充依实现与类型相关；`sizeof` 在表达式场景常为编译期求值。

## 表达式

表达式是由**运算符**和**操作数**组成的式子，用于计算并产生一个值。C语言中任何有值的式子都可以看作表达式。

### 算术表达式

算术表达式使用算术运算符对数值型数据进行数学运算。

**基本形式**
```c
int a = 10, b = 3;
double x = 5.5, y = 2.0;

// 加减乘除
int sum = a + b;        // 13
int diff = a - b;       // 7
int product = a * b;    // 30
int quotient = a / b;   // 3 (整数除法，截断小数部分)
int remainder = a % b;  // 1 (取余，仅适用于整数)

// 浮点运算
double result = x / y;  // 2.75 (浮点除法保留小数)
```

**注意事项**
- **整数除法**：两个整数相除结果仍为整数，小数部分被截断（不是四舍五入）
  ```c
  int a = 7 / 2;    // 结果是 3，不是 3.5
  double b = 7 / 2; // 结果是 3.0，因为右边先算出整数3，再转换
  double c = 7.0 / 2; // 结果是 3.5，因为有浮点数参与
  ```
- **取余运算**：`%` 仅用于整数，除数不能为0
- **混合运算**：整数与浮点数混合运算时，整数会自动提升为浮点数
- **运算优先级**：`*` `/` `%` 优先于 `+` `-`，使用括号改变优先级

**实用示例**
```c
// 计算圆的面积和周长
double radius = 5.0;
double pi = 3.14159;
double area = pi * radius * radius;      // 78.53975
double circumference = 2 * pi * radius;  // 31.4159

// 判断奇偶性
int num = 17;
if(num % 2 == 0) {
    printf("偶数\n");
} else {
    printf("奇数\n");  // 输出这个
}

// 交换两个数的值（算术方法，不推荐，易溢出）
int x = 5, y = 10;
x = x + y;  // x = 15
y = x - y;  // y = 5
x = x - y;  // x = 10
```

### 关系表达式

关系表达式使用关系运算符比较两个操作数的大小关系，结果为整数：真（非0，通常为1）或假（0）。

**基本形式**
```c
int a = 10, b = 20;

// 六种关系运算符
int result1 = (a < b);   // 1 (真)
int result2 = (a <= b);  // 1 (真)
int result3 = (a > b);   // 0 (假)
int result4 = (a >= b);  // 0 (假)
int result5 = (a == b);  // 0 (假，注意是两个等号)
int result6 = (a != b);  // 1 (真)
```

**常见用法**
```c
// 1. 用于条件判断
int score = 85;
if(score >= 60) {
    printf("及格\n");
}

// 2. 用于循环控制
for(int i = 0; i < 10; i++) {
    printf("%d ", i);
}

// 3. 多重比较（注意C语言不支持数学式连写）
int age = 25;
// 错误写法：if(18 <= age <= 60)  // 这会先算 18<=age 得到0或1，再拿0或1与60比较
// 正确写法：
if(age >= 18 && age <= 60) {
    printf("工作年龄\n");
}
```

**注意事项**
- **`==` vs `=`**：`==` 是比较运算符，`=` 是赋值运算符，初学者容易混淆
  ```c
  int x = 5;
  if(x = 10) {  // 错误！这是赋值，x变成10，表达式值为10（真）
      printf("总是执行\n");
  }
  if(x == 10) { // 正确！这是比较
      printf("x等于10\n");
  }
  ```
- **浮点数比较**：由于浮点数精度问题，不要直接用 `==` 比较
  ```c
  #include <math.h>  // fabs函数需要此头文件
  
  double a = 0.1 + 0.2;  // 可能是 0.30000000000000004
  if(a == 0.3) {         // 可能为假
      printf("相等\n");
  }
  // 推荐方法：比较差值的绝对值
  if(fabs(a - 0.3) < 1e-9) {
      printf("近似相等\n");
  }
  ```
- **关系运算符的优先级**：低于算术运算符，高于逻辑运算符
  ```c
  int result = 3 + 4 > 2 * 3;  // 等价于 (3+4) > (2*3)，即 7>6，结果为1
  ```

### 逻辑表达式

逻辑表达式使用逻辑运算符连接多个条件，结果为真（非0）或假（0）。

**三种逻辑运算符**
```c
int a = 1, b = 0, c = 5;

// 逻辑与 &&：两边都为真时结果才为真
int and_result = (a && b);      // 0 (假，因为b为0)
int and_result2 = (a && c);     // 1 (真，两者都非0)

// 逻辑或 ||：只要有一边为真结果就为真
int or_result = (a || b);       // 1 (真，因为a为1)
int or_result2 = (b || 0);      // 0 (假，两边都为0)

// 逻辑非 !：取反，真变假，假变真
int not_result = !a;            // 0 (a为1，取反得0)
int not_result2 = !b;           // 1 (b为0，取反得1)
```

**短路求值**（重要特性）
```c
int x = 0, y = 5;

// && 短路：左边为假时，右边不再求值
if(x != 0 && y / x > 2) {  // 因为 x!=0 为假，y/x 不会执行，避免除零错误
    printf("满足条件\n");
}

// || 短路：左边为真时，右边不再求值
if(x == 0 || y / x > 2) {  // 因为 x==0 为真，y/x 不会执行
    printf("满足条件\n");  // 输出这个
}

// 利用短路特性的实用技巧
int *ptr = NULL;
if(ptr != NULL && *ptr > 10) {  // 安全：只有ptr非空时才解引用
    printf("值大于10\n");
}
```

**常见应用场景**
```c
// 1. 范围判断
int age = 25;
if(age >= 18 && age <= 65) {
    printf("成年且未退休\n");
}

// 2. 多条件筛选
int score = 85;
char grade;
if(score >= 90) {
    grade = 'A';
} else if(score >= 80 && score < 90) {
    grade = 'B';
} else if(score >= 60 && score < 80) {
    grade = 'C';
} else {
    grade = 'D';
}

// 3. 复杂条件
int isWeekend = 1, hasTime = 1, hasRain = 0;
if((isWeekend || hasTime) && !hasRain) {
    printf("可以出去玩\n");
}
```

**优先级**
- `!` > 算术运算符 > 关系运算符 > `&&` > `||`
```c
int result = !0 || 2 + 3 > 4 && 1;
// 计算顺序：!0 → 1
//          2+3 → 5
//          5>4 → 1
//          1&&1 → 1
//          1||1 → 1
```

### 赋值表达式

赋值表达式使用赋值运算符将右边的值赋给左边的变量，表达式本身也有值（即赋的值）。

**基本赋值**
```c
int a, b, c;

// 简单赋值
a = 10;           // a的值为10，表达式的值也为10

// 连续赋值（从右向左结合）
a = b = c = 5;    // 等价于 a = (b = (c = 5))
                  // c=5, b=5, a=5

// 赋值表达式的值可用于其他表达式
int x = (a = 3) + 5;  // 先执行 a=3（值为3），再加5，x=8
```

**复合赋值运算符**
```c
int a = 10;

a += 5;   // 等价于 a = a + 5;   结果：15
a -= 3;   // 等价于 a = a - 3;   结果：12
a *= 2;   // 等价于 a = a * 2;   结果：24
a /= 4;   // 等价于 a = a / 4;   结果：6
a %= 4;   // 等价于 a = a % 4;   结果：2

// 复合赋值更简洁，有时也更高效
int arr[100];
arr[i++] += 5;  // 比 arr[i++] = arr[i++] + 5 更安全（避免i重复自增）
```

**常见用法**
```c
// 1. 累加器
int sum = 0;
for(int i = 1; i <= 100; i++) {
    sum += i;  // 累加
}

// 2. 计数器
int count = 0;
for(int i = 0; i < 100; i++) {
    if(arr[i] > 0) {
        count++;  // 等价于 count += 1 或 count = count + 1
    }
}

// 3. 位运算复合赋值
int flags = 0;
flags |= 0x01;   // 设置第0位
flags &= ~0x02;  // 清除第1位
flags ^= 0x04;   // 翻转第2位

// 4. 在条件中赋值（常见但需谨慎）
int value;
if((value = getInput()) != -1) {  // 先赋值，再判断
    printf("输入值：%d\n", value);
}

// 更推荐的写法（更清晰）
value = getInput();
if(value != -1) {
    printf("输入值：%d\n", value);
}
```

**注意事项**
- 赋值运算符的左边必须是**左值**（可修改的变量），不能是常量或表达式
  ```c
  10 = a;        // 错误！
  a + b = 10;    // 错误！
  ```
- 赋值表达式的结合性是**从右向左**
  ```c
  a = b = c = 0;  // 正确
  ```
- 不要把 `=` 和 `==` 混淆

### 其他常用表达式

#### 条件表达式（三目运算符）

**语法**：`条件 ? 表达式1 : 表达式2`

```c
// 基本用法
int a = 10, b = 20;
int max = (a > b) ? a : b;  // max = 20

// 等价的 if-else
int max;
if(a > b) {
    max = a;
} else {
    max = b;
}

// 嵌套使用（不推荐过度嵌套，影响可读性）
int a = 10, b = 20, c = 15;
int max = (a > b) ? ((a > c) ? a : c) : ((b > c) ? b : c);

// 实用示例
int score = 85;
char *result = (score >= 60) ? "及格" : "不及格";
printf("%s\n", result);

// 用于函数参数
printf("绝对值：%d\n", (num >= 0) ? num : -num);
```

#### 逗号表达式

**语法**：`表达式1, 表达式2, ..., 表达式n`

从左到右依次求值，整个表达式的值为最后一个表达式的值。

```c
// 基本用法
int a, b, c;
c = (a = 1, b = 2, a + b);  // a=1, b=2, c=3

// 常用于 for 循环（同时操作多个变量）
for(int i = 0, j = 10; i < j; i++, j--) {
    printf("i=%d, j=%d\n", i, j);
}

// 在一行执行多个操作
int x = 0, y = 0;
x = 5, y = 10, printf("x=%d, y=%d\n", x, y);

// 注意逗号优先级最低
int result = (a = 1, b = 2, a + b);  // result = 3 (需要括号)
result = a = 1, b = 2, a + b;        // result = 1 (逗号优先级低于赋值)
```

#### sizeof 表达式

获取数据类型或变量所占字节数，结果类型为 `size_t`。

```c
// 获取基本类型大小
printf("int: %zu bytes\n", sizeof(int));        // 通常 4
printf("double: %zu bytes\n", sizeof(double));  // 通常 8
printf("char: %zu bytes\n", sizeof(char));      // 1

// 获取变量大小
int a = 10;
printf("a: %zu bytes\n", sizeof(a));            // 4
printf("a: %zu bytes\n", sizeof a);             // 括号可省略（变量）

// 获取数组大小
int arr[10];
printf("数组大小：%zu bytes\n", sizeof(arr));     // 40 (10*4)
printf("数组元素个数：%zu\n", sizeof(arr)/sizeof(arr[0]));  // 10

// 获取指针大小
int *ptr;
printf("指针大小：%zu bytes\n", sizeof(ptr));     // 32位系统4字节，64位系统8字节
printf("指针指向类型大小：%zu\n", sizeof(*ptr));  // 4

// 获取结构体大小
struct Student {
    char name[20];
    int age;
    double score;
};
printf("结构体大小：%zu bytes\n", sizeof(struct Student));
```

#### 自增/自减表达式

```c
int a = 5, b;

// 前缀：先改变，后使用
b = ++a;  // a先变为6，然后b=6，结果：a=6, b=6

// 后缀：先使用，后改变
a = 5;
b = a++;  // b先取a的值5，然后a变为6，结果：a=6, b=5

// 常见用法
int arr[5] = {1, 2, 3, 4, 5};
int i = 0;
printf("%d\n", arr[i++]);  // 输出1，然后i变为1
printf("%d\n", arr[++i]);  // i先变为2，输出3

// 注意：不要在同一表达式中多次修改同一变量（未定义行为）
int x = 5;
int y = x++ + x++;  // 未定义行为！不同编译器可能结果不同
int z = x++ + ++x;  // 未定义行为！
```

#### 类型转换表达式

```c
// 隐式转换（自动）
int a = 10;
double b = a;      // int → double，自动转换
int c = 3.14;      // double → int，自动转换，c=3

// 显式转换（强制）
double x = 3.14;
int y = (int)x;    // y = 3

// 常见应用
int m = 7, n = 2;
double result = (double)m / n;  // 3.5（如果不转换则为3）

// 指针类型转换
void *ptr = malloc(sizeof(int));
int *intPtr = (int*)ptr;

// 注意：不要随意转换不兼容的类型
```

**表达式综合示例**
```c
#include <stdio.h>

int main(void) {
    // 复杂表达式示例
    int a = 5, b = 10, c = 15;
    int result;
    
    // 混合使用多种运算符
    result = (a + b) * c / 5 - (a > b ? a : b);
    // 计算过程：
    // (5+10) * 15 / 5 - (5>10 ? 5 : 10)
    // 15 * 15 / 5 - 10
    // 225 / 5 - 10
    // 45 - 10
    // 35
    printf("result = %d\n", result);
    
    // 短路求值与赋值结合
    int x = 0;
    int y = (x != 0) && (100 / x > 5);  // 安全，不会除零
    
    // 逗号表达式与循环
    for(int i = 0, sum = 0; i < 5; sum += i, i++) {
        printf("i=%d, sum=%d\n", i, sum);
    }
    
    return 0;
}
```
